# FlyAndEarn Internationalization (i18n) System

## Overview

FlyAndEarn uses a comprehensive i18n system that supports:
- **Country + Language** locale selection (e.g., `en-GB`, `fr-FR`, `de-CH`)
- **Contextual translations** with domain-specific terminology
- **Pluralization** with locale-specific rules
- **Interpolation** for dynamic content
- **Formatting** for currency, dates, numbers, distances, and addresses
- **Server-side i18n** for API messages and emails

## Supported Locales

| Locale | Language | Country | Currency | Distance |
|--------|----------|---------|----------|----------|
| `en-GB` | English | United Kingdom | GBP | miles |
| `en-US` | English | United States | USD | miles |
| `fr-FR` | French | France | EUR | km |
| `fr-CH` | French | Switzerland | CHF | km |
| `pl-PL` | Polish | Poland | PLN | km |
| `de-DE` | German | Germany | EUR | km |
| `de-CH` | German | Switzerland | CHF | km |
| `de-AT` | German | Austria | EUR | km |

## Quick Start

### Client-Side Usage

```javascript
import { i18n, t } from './src/i18n/index.js';

// Initialize (usually in your app entry point)
await i18n.init({ userLocale: user.preferredLocale });

// Translate a key
const greeting = t('common:greeting');

// With interpolation
const welcome = t('auth.welcome', { name: 'John' });

// With pluralization
const items = t('cart.items', { count: 5 });

// Format currency
const price = i18n.formatCurrency(29.99, 'EUR');

// Format date
const date = i18n.formatDate(new Date(), 'long');
```

### Server-Side Usage (Netlify Functions)

```javascript
import { getI18nForRequest, getLocalizedError, ERROR_CODES } from './lib/i18n.js';

export async function handler(event) {
  const i18n = getI18nForRequest(event);

  // Translate error message
  if (!user) {
    return jsonResponse(404, {
      error: i18n.t('errors.notFound'),
    });
  }

  // Using error codes
  return jsonResponse(401, {
    error: getLocalizedError(ERROR_CODES.UNAUTHORIZED, i18n),
  });
}
```

### HTML Data Attributes

```html
<!-- Text content -->
<h1 data-i18n="hero.title">Turn Your Duty-Free Allowance Into Cash</h1>

<!-- With interpolation -->
<p data-i18n="auth.welcome" data-i18n-options='{"name":"John"}'>Welcome, John!</p>

<!-- Placeholder -->
<input data-i18n-placeholder="form.email" placeholder="Enter email">

<!-- Title/tooltip -->
<button data-i18n-title="actions.save.tooltip">Save</button>

<!-- ARIA label -->
<button data-i18n-aria="accessibility.closeModal" aria-label="Close">Ã—</button>
```

## File Structure

```
src/i18n/
â”œâ”€â”€ index.js           # Main i18n module (client-side)
â”œâ”€â”€ translations.js    # All translation strings
â”œâ”€â”€ formatters.js      # Currency, date, number formatters
â”œâ”€â”€ glossary.js        # Domain terminology with translator notes
â”œâ”€â”€ locale-selector.js # UI component for locale selection

netlify/functions/lib/
â”œâ”€â”€ i18n.js            # Server-side i18n utilities

scripts/
â”œâ”€â”€ i18n-check.js      # CI validation script

docs/
â”œâ”€â”€ i18n.md            # This documentation
```

## How to Add a New Locale

### 1. Add to Supported Locales

In `src/i18n/index.js`:

```javascript
export const SUPPORTED_LOCALES = [
  'en-GB', 'en-US', 'fr-FR', 'pl-PL', 'de-DE',
  'it-IT',  // Add new locale
];

export const SUPPORTED_LANGUAGES = ['en', 'fr', 'pl', 'de', 'it'];  // Add language

// Add to LOCALE_VARIANTS
const LOCALE_VARIANTS = {
  // ...existing
  'it-IT': { currency: 'EUR', dateFormat: 'dd/MM/yyyy', distanceUnit: 'km' },
};
```

### 2. Add Translations

In `src/i18n/translations.js`, add the new language to each key:

```javascript
'hero.title': {
  en: 'Turn Your <span>Duty-Free Allowance</span> Into Cash',
  fr: 'Transformez Votre <span>Franchise Duty-Free</span> en Argent',
  pl: 'ZamieÅ„ SwÃ³j <span>Limit Duty-Free</span> na GotÃ³wkÄ™',
  de: 'Verwandeln Sie Ihr <span>Duty-Free-Kontingent</span> in Bargeld',
  it: 'Trasforma la Tua <span>Franchigia Duty-Free</span> in Contanti',  // New
},
```

### 3. Add to Glossary

In `src/i18n/glossary.js`:

```javascript
traveller: {
  translations: {
    // ...existing
    'it-IT': 'Viaggiatore',
  },
},
```

### 4. Add Server Translations

In `netlify/functions/lib/i18n.js`:

```javascript
'errors.notFound': {
  en: 'The requested resource was not found.',
  fr: 'La ressource demandÃ©e n\'a pas Ã©tÃ© trouvÃ©e.',
  pl: 'Nie znaleziono Å¼Ä…danego zasobu.',
  de: 'Die angeforderte Ressource wurde nicht gefunden.',
  it: 'La risorsa richiesta non Ã¨ stata trovata.',  // New
},
```

### 5. Add to Locale Selector

In `src/i18n/locale-selector.js`:

```javascript
const LOCALE_DISPLAY = {
  // ...existing
  'it-IT': { name: 'Italiano', flag: 'ðŸ‡®ðŸ‡¹' },
};

const LANGUAGE_NAMES = {
  // ...existing
  it: { native: 'Italiano', en: 'Italian' },
};
```

### 6. Run Validation

```bash
npm run i18n:check
```

## Translation Guidelines

### Contextual Translation (Not Literal)

**DO:**
- Translate meaning, not words
- Use natural phrasing for the target locale
- Consider cultural context

**DON'T:**
- Word-for-word translation
- Machine translation without review
- Mix formal/informal tone

### Example: "Outside Duty-Free"

| Locale | Translation | Note |
|--------|-------------|------|
| en-GB | Regular store shopping | Clarifies it's not airport duty-free |
| de-DE | EinkÃ¤ufe im Einzelhandel | "Retail shopping" - natural German |
| de-CH | EinkÃ¤ufe im Detailhandel | Swiss German term for retail |
| pl-PL | Zakupy w sklepach detalicznych | Polish term for retail shopping |

### Placeholders

Always preserve placeholders exactly:

```javascript
// English
'You have {{count}} new messages'

// French - placeholder must match
'Vous avez {{count}} nouveaux messages'

// NOT 'Vous avez {{nombre}} nouveaux messages'
```

### Pluralization

Use plural forms for countable items:

```javascript
// English uses: zero, one, other
'cart.items_zero': { en: 'Your cart is empty' },
'cart.items_one': { en: 'You have 1 item' },
'cart.items_other': { en: 'You have {{count}} items' },

// Polish uses: zero, one, few, many, other
'cart.items_zero': { pl: 'TwÃ³j koszyk jest pusty' },
'cart.items_one': { pl: 'Masz 1 przedmiot' },
'cart.items_few': { pl: 'Masz {{count}} przedmioty' },  // 2-4
'cart.items_many': { pl: 'Masz {{count}} przedmiotÃ³w' }, // 5+
```

## Locale Resolution Priority

The system resolves the user's locale in this order:

1. **User Profile** - `user.preferredLocale` (if logged in)
2. **Cookie** - `fae_locale` cookie
3. **URL Parameter** - `?lang=fr` or `?locale=fr-FR`
4. **Accept-Language Header** - Browser preference
5. **Default** - `en-GB`

## Formatting Reference

### Currency

```javascript
i18n.formatCurrency(1234.50, 'EUR', 'de-DE')  // "1.234,50 â‚¬"
i18n.formatCurrency(1234.50, 'PLN', 'pl-PL')  // "1 234,50 zÅ‚"
i18n.formatCurrency(1234.50, 'GBP', 'en-GB')  // "Â£1,234.50"
```

### Dates

```javascript
i18n.formatDate(date, 'short')   // "23/01/2025" (UK) / "1/23/2025" (US)
i18n.formatDate(date, 'medium')  // "23 Jan 2025"
i18n.formatDate(date, 'long')    // "23 January 2025"
i18n.formatDate(date, 'full')    // "Thursday, 23 January 2025"
```

### Numbers

```javascript
formatNumber(1234567.89, 'de-DE')  // "1.234.567,89"
formatNumber(1234567.89, 'en-US')  // "1,234,567.89"
formatNumber(1234567.89, 'fr-FR')  // "1 234 567,89"
```

### Distance

```javascript
formatDistance(100, 'en-GB')  // "62 mi"
formatDistance(100, 'de-DE')  // "100 km"
```

## Testing

### Run i18n Tests

```bash
npm test -- tests/i18n.test.js
```

### Run CI Validation

```bash
npm run i18n:check
```

This will:
- Check for missing required translations (en, pl)
- Verify placeholder consistency across locales
- Flag empty translations
- Check glossary completeness

## QA Checklist

### Manual Testing

- [ ] Switch language and verify immediate UI update
- [ ] Switch country (same language) and verify formatting changes
- [ ] Check currency format matches country (EUR/PLN/GBP/CHF)
- [ ] Check date format matches country conventions
- [ ] Verify distance units (km vs miles)
- [ ] Test with logged-in user - preference should persist
- [ ] Test anonymous user - cookie should persist
- [ ] Test API error messages are localized
- [ ] Verify glossary terms are consistent throughout UI

### Pages to Check

- [ ] Landing page (index.html)
- [ ] Dashboard (dashboard.html)
- [ ] Wallet (wallet.html)
- [ ] Terms of Service (terms.html)
- [ ] Privacy Policy (privacy.html)
- [ ] Login/Register modals
- [ ] Trip creation form
- [ ] Request creation form
- [ ] Messages page

### Edge Cases

- [ ] Long translations don't break layout
- [ ] RTL text (future) if supporting Arabic
- [ ] Emoji in translations render correctly
- [ ] Special characters (Ã¼, Ä™, Å›, etc.) display correctly
- [ ] Numbers with different decimal separators
